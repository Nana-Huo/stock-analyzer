<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡å®æ—¶æ•°æ®åˆ†æ - éœå† å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .author {
            color: #666;
            font-size: 1.2em;
        }

        .add-stock {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .add-stock h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .input-group input {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stock-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .stock-card:hover {
            transform: translateY(-5px);
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stock-header h3 {
            color: #667eea;
            font-size: 1.5em;
        }

        .stock-header .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .stock-header .remove-btn:hover {
            background: #ff3838;
            transform: scale(1.05);
        }

        .stock-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
        }

        .info-item label {
            display: block;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .info-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .info-item .value.up {
            color: #2ecc71;
        }

        .info-item .value.down {
            color: #e74c3c;
        }

        .analysis {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .analysis h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .analysis p {
            color: #666;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .last-update {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
            font-size: 1.1em;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-btn:hover {
            transform: rotate(180deg);
            box-shadow: 0 5px 30px rgba(102, 126, 234, 0.6);
        }

        .refresh-btn.loading {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .empty-state {
            background: rgba(255, 255, 255, 0.95);
            padding: 60px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .empty-state h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .empty-state p {
            color: #666;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .stocks-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .stock-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Aè‚¡å®æ—¶æ•°æ®åˆ†æ</h1>
            <p class="author">å¼€å‘è€…ï¼šéœå† å</p>
        </div>

        <div class="add-stock">
            <h2>æ·»åŠ è‡ªé€‰è‚¡</h2>
            <div class="input-group">
                <input type="text" id="stockCode" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000547ã€600519ï¼‰" onkeypress="if(event.key==='Enter') addStock()">
                <button onclick="addStock()">æ·»åŠ </button>
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                æ”¯æŒï¼šæ·±äº¤æ‰€ï¼ˆ000xxxã€002xxxã€300xxxï¼‰ã€ä¸Šäº¤æ‰€ï¼ˆ600xxxã€601xxxã€688xxxï¼‰
            </p>
            <div style="margin-top: 15px;">
                <p style="color: #667eea; font-size: 0.9em; margin-bottom: 10px;">å¿«é€Ÿæ·»åŠ ç¤ºä¾‹ï¼š</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="quickAdd('000547')" style="padding: 8px 15px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 14px; transition: all 0.3s;" onmouseover="this.style.background='#e0e0e0'" onmouseout="this.style.background='#f0f0f0'">000547 èˆªå¤©å‘å±•</button>
                    <button onclick="quickAdd('600519')" style="padding: 8px 15px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 14px; transition: all 0.3s;" onmouseover="this.style.background='#e0e0e0'" onmouseout="this.style.background='#f0f0f0'">600519 è´µå·èŒ…å°</button>
                    <button onclick="quickAdd('000858')" style="padding: 8px 15px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 14px; transition: all 0.3s;" onmouseover="this.style.background='#e0e0e0'" onmouseout="this.style.background='#f0f0f0'">000858 äº”ç²®æ¶²</button>
                    <button onclick="quickAdd('601318')" style="padding: 8px 15px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-size: 14px; transition: all 0.3s;" onmouseover="this.style.background='#e0e0e0'" onmouseout="this.style.background='#f0f0f0'">601318 ä¸­å›½å¹³å®‰</button>
                </div>
            </div>
        </div>

        <div class="stocks-grid" id="stocksGrid">
            <div class="empty-state">
                <h3>è¿˜æ²¡æœ‰è‡ªé€‰è‚¡</h3>
                <p>åœ¨ä¸Šæ–¹è¾“å…¥è‚¡ç¥¨ä»£ç ï¼Œæ·»åŠ ä½ å…³æ³¨çš„è‚¡ç¥¨</p>
            </div>
        </div>

        <div class="last-update" id="lastUpdate">
            æœ€åæ›´æ–°ï¼š--
        </div>
    </div>

    <button class="refresh-btn" id="refreshBtn" onclick="refreshAllStocks()" title="åˆ·æ–°æ•°æ®">
        ğŸ”„
    </button>

    <script>
        // ä»localStorageåŠ è½½è‡ªé€‰è‚¡
        let watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderStocks();
            if (watchlist.length > 0) {
                refreshAllStocks();
            }
        });

        // æ·»åŠ è‚¡ç¥¨
        async function addStock() {
            const code = document.getElementById('stockCode').value.trim().toUpperCase();
            if (!code) {
                alert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
                return;
            }

            // éªŒè¯è‚¡ç¥¨ä»£ç æ ¼å¼
            if (!/^[0-9]{6}$/.test(code)) {
                alert('è‚¡ç¥¨ä»£ç æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥6ä½æ•°å­—');
                return;
            }

            if (watchlist.includes(code)) {
                alert('è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰è‚¡ä¸­');
                return;
            }

            // å…ˆéªŒè¯è‚¡ç¥¨ä»£ç æ˜¯å¦æœ‰æ•ˆ
            try {
                const exchange = code.startsWith('6') ? 'sh' : 'sz';
                const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(`http://qt.gtimg.cn/q=${exchange}${code}`)}`;
                
                const response = await fetch(url);
                const data = await response.text();
                
                const match = data.match(/v_.*="([^"]+)"/);
                if (!match) {
                    alert('è‚¡ç¥¨ä»£ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•');
                    return;
                }

                const values = match[1].split('~');
                if (!values[1] || values[1] === '') {
                    alert('è‚¡ç¥¨ä»£ç æ— æ•ˆæˆ–å·²é€€å¸‚');
                    return;
                }

                watchlist.push(code);
                saveWatchlist();
                renderStocks();
                refreshAllStocks();
                document.getElementById('stockCode').value = '';
            } catch (error) {
                alert('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è‚¡ç¥¨ä»£ç ');
                console.error('æ·»åŠ è‚¡ç¥¨å¤±è´¥:', error);
            }
        }

        // å¿«é€Ÿæ·»åŠ ç¤ºä¾‹è‚¡ç¥¨
        async function quickAdd(code) {
            if (watchlist.includes(code)) {
                alert('è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰è‚¡ä¸­');
                return;
            }

            try {
                const exchange = code.startsWith('6') ? 'sh' : 'sz';
                const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(`http://qt.gtimg.cn/q=${exchange}${code}`)}`;
                
                const response = await fetch(url);
                const data = await response.text();
                
                const match = data.match(/v_.*="([^"]+)"/);
                if (!match) {
                    alert('è‚¡ç¥¨ä»£ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•');
                    return;
                }

                const values = match[1].split('~');
                if (!values[1] || values[1] === '') {
                    alert('è‚¡ç¥¨ä»£ç æ— æ•ˆæˆ–å·²é€€å¸‚');
                    return;
                }

                watchlist.push(code);
                saveWatchlist();
                renderStocks();
                refreshAllStocks();
            } catch (error) {
                alert('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                console.error('æ·»åŠ è‚¡ç¥¨å¤±è´¥:', error);
            }
        }

        // ç§»é™¤è‚¡ç¥¨
        function removeStock(code) {
            if (confirm(`ç¡®å®šè¦ç§»é™¤ ${code} å—ï¼Ÿ`)) {
                watchlist = watchlist.filter(c => c !== code);
                saveWatchlist();
                renderStocks();
            }
        }

        // ä¿å­˜è‡ªé€‰è‚¡
        function saveWatchlist() {
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
        }

        // æ¸²æŸ“è‚¡ç¥¨åˆ—è¡¨
        function renderStocks() {
            const grid = document.getElementById('stocksGrid');

            if (watchlist.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <h3>è¿˜æ²¡æœ‰è‡ªé€‰è‚¡</h3>
                        <p>åœ¨ä¸Šæ–¹è¾“å…¥è‚¡ç¥¨ä»£ç ï¼Œæ·»åŠ ä½ å…³æ³¨çš„è‚¡ç¥¨</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = watchlist.map(code => `
                <div class="stock-card" id="stock-${code}">
                    <div class="stock-header">
                        <div>
                            <h3 id="name-${code}">${code}</h3>
                            <p style="color: #999; font-size: 0.9em; margin-top: 5px;">${code}</p>
                        </div>
                        <button class="remove-btn" onclick="removeStock('${code}')">ç§»é™¤</button>
                    </div>
                    <div class="stock-info">
                        <div class="info-item">
                            <label>å½“å‰ä»·æ ¼</label>
                            <div class="value" id="price-${code}">--</div>
                        </div>
                        <div class="info-item">
                            <label>æ¶¨è·Œå¹…</label>
                            <div class="value" id="change-${code}">--</div>
                        </div>
                        <div class="info-item">
                            <label>æˆäº¤é‡</label>
                            <div class="value" id="volume-${code}">--</div>
                        </div>
                        <div class="info-item">
                            <label>æˆäº¤é¢</label>
                            <div class="value" id="amount-${code}">--</div>
                        </div>
                    </div>
                    <div class="analysis">
                        <h4>å®æ—¶åˆ†æ</h4>
                        <p id="analysis-${code}">æ­£åœ¨è·å–æ•°æ®...</p>
                    </div>
                </div>
            `).join('');
        }

        // åˆ·æ–°æ‰€æœ‰è‚¡ç¥¨
        async function refreshAllStocks() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('loading');

            const promises = watchlist.map(code => fetchStockData(code));
            await Promise.all(promises);

            refreshBtn.classList.remove('loading');
            updateLastUpdate();
        }

        // è·å–è‚¡ç¥¨æ•°æ®
        async function fetchStockData(code) {
            try {
                // åˆ¤æ–­äº¤æ˜“æ‰€
                const exchange = code.startsWith('6') ? 'sh' : 'sz';
                // ä½¿ç”¨CORSä»£ç†è§£å†³è·¨åŸŸé—®é¢˜
                const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(`http://qt.gtimg.cn/q=${exchange}${code}`)}`;

                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                }
                const data = await response.text();

                // æ£€æŸ¥æ˜¯å¦è¿”å›äº†æœ‰æ•ˆæ•°æ®
                if (!data || data.trim() === '') {
                    throw new Error('æ— æ•°æ®è¿”å›');
                }

                // è§£ææ•°æ®
                const match = data.match(/v_.*="([^"]+)"/);
                if (!match) {
                    throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
                }

                const values = match[1].split('~');
                
                // éªŒè¯æ•°æ®æœ‰æ•ˆæ€§
                if (values.length < 40 || !values[1] || !values[3]) {
                    throw new Error('è‚¡ç¥¨ä»£ç æ— æ•ˆæˆ–å·²é€€å¸‚');
                }

                const stockData = {
                    name: values[1],
                    price: parseFloat(values[3]) || 0,
                    change: parseFloat(values[4]) || 0,
                    changePercent: parseFloat(values[32]) || 0,
                    volume: parseFloat(values[6]) || 0,
                    amount: parseFloat(values[37]) || 0,
                    open: parseFloat(values[5]) || 0,
                    high: parseFloat(values[33]) || 0,
                    low: parseFloat(values[34]) || 0,
                    yesterdayClose: parseFloat(values[4]) || 0
                };

                // æ£€æŸ¥ä»·æ ¼æ˜¯å¦æœ‰æ•ˆ
                if (stockData.price === 0) {
                    throw new Error('è‚¡ç¥¨ä»·æ ¼æ— æ•ˆ');
                }

                updateStockDisplay(code, stockData);
            } catch (error) {
                console.error(`è·å– ${code} æ•°æ®å¤±è´¥:`, error);
                const analysisEl = document.getElementById(`analysis-${code}`);
                if (analysisEl) {
                    analysisEl.textContent = `è·å–æ•°æ®å¤±è´¥ï¼š${error.message}`;
                    analysisEl.style.color = '#e74c3c';
                }
                
                // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                const priceEl = document.getElementById(`price-${code}`);
                const changeEl = document.getElementById(`change-${code}`);
                if (priceEl) priceEl.textContent = 'è·å–å¤±è´¥';
                if (changeEl) changeEl.textContent = '--';
            }
        }

        // æ›´æ–°è‚¡ç¥¨æ˜¾ç¤º
        function updateStockDisplay(code, data) {
            // æ›´æ–°è‚¡ç¥¨åç§°
            const nameEl = document.getElementById(`name-${code}`);
            if (nameEl) {
                nameEl.textContent = data.name || code;
            }

            // æ›´æ–°ä»·æ ¼
            const priceEl = document.getElementById(`price-${code}`);
            priceEl.textContent = data.price.toFixed(2);
            priceEl.className = 'value ' + (data.changePercent >= 0 ? 'up' : 'down');

            // æ›´æ–°æ¶¨è·Œå¹…
            const changeEl = document.getElementById(`change-${code}`);
            changeEl.textContent = `${data.changePercent >= 0 ? '+' : ''}${data.changePercent.toFixed(2)}%`;
            changeEl.className = 'value ' + (data.changePercent >= 0 ? 'up' : 'down');

            // æ›´æ–°æˆäº¤é‡
            const volumeEl = document.getElementById(`volume-${code}`);
            volumeEl.textContent = formatVolume(data.volume);

            // æ›´æ–°æˆäº¤é¢
            const amountEl = document.getElementById(`amount-${code}`);
            amountEl.textContent = formatAmount(data.amount);

            // ç”Ÿæˆåˆ†æ
            const analysis = generateAnalysis(data);
            const analysisEl = document.getElementById(`analysis-${code}`);
            if (analysisEl) {
                analysisEl.textContent = analysis;
                analysisEl.style.color = '#666';
            }
        }

        // æ ¼å¼åŒ–æˆäº¤é‡
        function formatVolume(volume) {
            if (volume >= 100000000) {
                return (volume / 100000000).toFixed(2) + 'äº¿';
            } else if (volume >= 10000) {
                return (volume / 10000).toFixed(2) + 'ä¸‡';
            }
            return volume.toFixed(0);
        }

        // æ ¼å¼åŒ–æˆäº¤é¢
        function formatAmount(amount) {
            if (amount >= 100000000) {
                return (amount / 100000000).toFixed(2) + 'äº¿';
            } else if (amount >= 10000) {
                return (amount / 10000).toFixed(2) + 'ä¸‡';
            }
            return amount.toFixed(0);
        }

        // ç”Ÿæˆåˆ†æ
        function generateAnalysis(data) {
            const trend = data.changePercent >= 0 ? 'ä¸Šæ¶¨' : 'ä¸‹è·Œ';
            const strength = Math.abs(data.changePercent) >= 5 ? 'å¼ºåŠ¿' :
                           Math.abs(data.changePercent) >= 2 ? 'ä¸­ç­‰' : 'å¼±åŠ¿';

            let analysis = `å½“å‰è‚¡ä»·${trend}${strength}ï¼Œ`;

            if (data.changePercent >= 5) {
                analysis += 'æ¶¨å¹…è¾ƒå¤§ï¼Œå»ºè®®å…³æ³¨é£é™©ï¼Œä¸å®œè¿½é«˜ã€‚';
            } else if (data.changePercent >= 2) {
                analysis += 'è¡¨ç°è¾ƒå¥½ï¼Œå¯ç»§ç»­è§‚å¯Ÿã€‚';
            } else if (data.changePercent >= 0) {
                analysis += 'å°å¹…ä¸Šæ¶¨ï¼Œèµ°åŠ¿å¹³ç¨³ã€‚';
            } else if (data.changePercent >= -2) {
                analysis += 'å°å¹…ä¸‹è·Œï¼Œèµ°åŠ¿åå¼±ã€‚';
            } else if (data.changePercent >= -5) {
                analysis += 'è·Œå¹…è¾ƒå¤§ï¼Œå»ºè®®è°¨æ…ã€‚';
            } else {
                analysis += 'å¤§å¹…ä¸‹è·Œï¼Œæ³¨æ„é£é™©æ§åˆ¶ã€‚';
            }

            if (data.volume > 0) {
                analysis += ` æˆäº¤é‡${formatVolume(data.volume)}ï¼Œæˆäº¤é¢${formatAmount(data.amount)}ã€‚`;
            }

            return analysis;
        }

        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        function updateLastUpdate() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN');
            document.getElementById('lastUpdate').textContent = `æœ€åæ›´æ–°ï¼š${timeStr}`;
        }

        // è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰
        setInterval(() => {
            if (watchlist.length > 0) {
                refreshAllStocks();
            }
        }, 30000);
    </script>
</body>
</html>